# AI 语音日记本 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
一款基于 AI 的语音日记应用，通过自然对话帮助用户记录生活，自动生成精美的散文式日记卡片。

### 1.2 目标用户
- 希望记录生活但不喜欢打字的用户
- 喜欢通过口语表达情感的用户
- 追求简洁、美观日记体验的用户
- 想要通过对话整理思绪的用户

### 1.3 核心价值
- **便捷性**: 语音输入，无需打字
- **引导性**: AI 引导对话，帮助用户深入思考
- **文学性**: 自动生成散文式日记，提升记录品质
- **美观性**: 现代扁平化设计，渐变配色，视觉愉悦

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 对话引导
**用户故事**: 作为用户，我希望选择对话焦点，以便 AI 能更好地引导我分享今天的生活。

**功能描述**:
- 提供 4 种对话焦点选项：
  - 记录事件 - 聊聊今天发生的特别事情
  - 分享感受 - 表达今天的情绪和心情
  - 成长感悟 - 分享今天的收获与思考
  - 全面回顾 - 聊聊今天的方方面面
- 每个选项包含图标、标题、描述
- 用户选择后进入对话界面

**验收标准**:
- 选项卡片有清晰的视觉反馈
- 选择后焦点信息保存到 localStorage
- 可在设置中更改默认偏好

#### 2.1.2 语音对话
**用户故事**: 作为用户，我希望通过语音与 AI 对话，以便自然地记录想法。

**功能描述**:
- 支持两种对话模式：
  - **经典模式**: 点击麦克风说话，发送后获得 AI 回复
  - **实时模式**: 长按麦克风说话，实时转文字并对话
- AI 根据选择的对话焦点引导对话
- 消息以聊天气泡形式展示
- 自动滚动到最新消息
- 支持文字输入作为备选方案

**验收标准**:
- 语音识别准确率 > 90%
- AI 回复延迟 < 3 秒
- 对话流畅自然，符合设定的人设
- 消息持久化到 Zustand store

#### 2.1.3 日记生成
**用户故事**: 作为用户，我希望 AI 能将对话内容整理成优美的日记，以便我保存今天的记忆。

**功能描述**:
- 用户点击"完成对话"触发日记生成
- AI 分析对话内容，生成包含以下元素的日记：
  - 天气（从对话推断或默认值）
  - 心情标签（2-3 个）
  - 散文式正文（200-500 字）
- 支持重新生成
- 预览界面可切换查看对话记录和生成的日记

**验收标准**:
- 生成时间 < 5 秒
- 日记内容基于对话事实，不虚构细节
- 语言温暖治愈，具有文学性
- 内容解析准确，weather 和 mood 不出现在正文中

#### 2.1.4 日记保存与展示
**用户故事**: 作为用户，我希望保存日记并在回廊中查看，以便回顾过去的时光。

**功能描述**:
- 保存到 localStorage（后续迁移到 Supabase）
- 日记回廊以时间倒序展示所有日记
- 每篇日记卡片显示：
  - 日期
  - 天气（带图标）
  - 心情标签（带图标）
  - 日记内容预览（50 字符）
- 点击"查看详情"展开/收起完整内容
- 支持实时更新（保存新日记后自动刷新）

**验收标准**:
- 保存成功后跳转到日记回廊
- 卡片展开/收起动画流畅
- 日期格式本地化（中文）
- 空状态引导用户开始写日记

### 2.2 辅助功能

#### 2.2.1 设置页面
**功能描述**:
- 统计信息：已记录天数、总字数
- 对话偏好：默认对话焦点
- 语音设置：语音播放开关、播放速度
- API 配置：用户可配置自己的 API Keys（可选）
- 数据管理：清除所有数据

**验收标准**:
- 设置项修改后立即生效
- API Keys 加密存储
- 清除数据前有确认提示

#### 2.2.2 语音合成
**功能描述**:
- AI 回复支持语音播放
- 使用智谱 GLM-TTS 生成语音
- 可调节播放速度
- 可在设置中关闭语音功能

**验收标准**:
- 语音清晰自然
- 播放流畅无卡顿
- 播放时可暂停

## 3. 非功能需求

### 3.1 性能
- 首页加载时间 < 2 秒
- API 响应时间 < 3 秒
- 页面切换动画流畅（60fps）

### 3.2 兼容性
- 支持主流现代浏览器（Chrome、Safari、Firefox、Edge）
- 响应式设计，支持移动端
- iOS Safari 兼容（语音功能）

### 3.3 安全性
- API Keys 不暴露给前端（通过服务端代理）
- localStorage 数据仅存储在客户端
- 不收集用户隐私数据

### 3.4 可维护性
- TypeScript 严格模式
- 组件化设计
- 清晰的代码结构
- 完善的类型定义

## 4. UI/UX 设计

### 4.1 设计风格
- **设计语言**: 现代扁平化设计 + Figma 风格活力渐变
- **主色调**: 靛蓝 (#6366f1) + 紫色 (#8b5cf6) 渐变
- **辅助色**: 粉红 (#ec4899)、琥珀 (#f59e0b)
- **图标**: lucide-react 扁平化图标
- **字体**: 系统默认字体 + 手写字体（Ma Shan Zheng）点缀

### 4.2 核心页面

#### 4.2.1 首页
- 大型欢迎卡片
- 两个主要入口：开始对话、日记回廊
- 渐变背景营造温暖氛围
- 手写字体标题增添亲切感

#### 4.2.2 对话焦点选择页
- 4 个焦点选项垂直排列
- 选中项有明显的视觉反馈（渐变背景 + 缩放）
- 底部固定的"开始对话"按钮

#### 4.2.3 聊天页
- 消息气泡对话界面
- 底部输入框 + 麦克风按钮
- 顶部导航栏（返回 + 标题 + 完成对话）
- 模式切换开关（经典/实时）

#### 4.2.4 预览页
- 顶部视图切换（对话记录 / 生成的日记）
- 日记卡片包含：
  - 日期（完整格式）
  - 天气和心情标签
  - 日记正文（分段展示）
- 底部操作栏（重新生成 / 保存日记）

#### 4.2.5 日记回廊
- 时间倒序的日记卡片列表
- 每个卡片可展开/收起
- 空状态有引导提示

#### 4.2.6 设置页
- 分组展示设置项
- 统计卡片突出显示
- 开关、滑块等交互控件

### 4.3 动画效果
- 页面切换淡入淡出
- 卡片展开平滑过渡
- 按钮点击反馈
- 加载状态旋转动画

## 5. 技术架构

### 5.1 前端
- **框架**: Next.js 16.1.1 (App Router)
- **UI**: Tailwind CSS v4 + lucide-react
- **状态**: Zustand + persist middleware
- **类型**: TypeScript 5

### 5.2 后端
- **API Routes**: Next.js API Routes
- **AI 服务**:
  - DeepSeek Chat（对话、日记生成）
  - 智谱 GLM-4.7（语音识别、合成）
  - Gemini 2.5 Flash（备用）

### 5.3 存储
- **当前**: localStorage
- **未来**: Supabase (PostgreSQL)

## 6. 数据模型

### 6.1 日记 (Diary)
```typescript
interface Diary {
  id: string                // UUID
  user_id: string           // 用户 ID
  date: string              // 日期 (YYYY-MM-DD)
  weather: string           // 天气
  moodTags: string[]        // 心情标签
  content: string           // 日记正文
  created_at: string        // 创建时间
}
```

### 6.2 消息 (Message)
```typescript
interface Message {
  id: string                // UUID
  role: 'user' | 'assistant'
  content: string
  timestamp?: string
}
```

### 6.3 对话会话 (Session)
```typescript
interface Session {
  id: string
  focus: DialogueFocus      // 对话焦点
  startTime: string
  messages: Message[]
}
```

## 7. 路线图

### Phase 1: 核心功能（已完成）
- [x] 对话引导
- [x] 语音对话
- [x] 日记生成
- [x] 日记保存与展示
- [x] 设置页面
- [x] 现代化 UI 设计

### Phase 2: 优化与完善
- [ ] Supabase 数据库集成
- [ ] 用户认证系统
- [ ] 数据同步
- [ ] 日记编辑功能
- [ ] 搜索与筛选

### Phase 3: 增强功能
- [ ] 日记配图（AI 生成或用户上传）
- [ ] 地点标记
- [ ] 背景音乐
- [ ] 导出 PDF
- [ ] 分享功能

### Phase 4: 多端支持
- [ ] iOS 应用
- [ ] Android 应用
- [ ] 桌面应用

## 8. 成功指标

### 8.1 用户指标
- 日活用户数 (DAU)
- 日记创建率
- 对话完成率
- 用户留存率

### 8.2 技术指标
- API 调用成功率 > 99%
- 平均响应时间 < 3 秒
- 错误率 < 1%

### 8.3 业务指标
- 用户满意度
- 付费转化率（未来）
- 用户推荐度 (NPS)

## 9. 风险与限制

### 9.1 技术风险
- AI API 稳定性依赖第三方
- 语音识别在嘈杂环境下准确率下降
- 浏览器兼容性问题（尤其是语音功能）

### 9.2 产品限制
- 依赖网络连接
- API 调用产生成本
- 用户隐私顾虑

### 9.3 应对措施
- 多个 AI 服务备份
- 优雅的错误处理和用户提示
- 清晰的隐私政策
- 支持离线查看已保存的日记

## 10. 版本历史

### v1.0.0 (当前)
- 核心功能完整实现
- 现代扁平化 UI 设计
- localStorage 数据持久化
- 完整的语音对话流程

---

*文档最后更新: 2025-01-06*
